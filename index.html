<!DOCTYPE html>
<html>
  <head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container">
      <ul class="comments" id="comments">
        <li class="comment" id="comment">
          <div class="comment-header">
            <div>Глеб Фокин</div>
            <div>12.02.22 12:18</div>
          </div>
          <div class="comment-body">
            <div class="comment-text">
              Это будет первый комментарий на этой странице
            </div>
          </div>
          <div class="comment-footer">
            <div class="likes">
              <span class="likes-counter">${comment.likes}</span>
              <button class="like-button"></button>
            </div>
          </div>
        </li>
        <li class="comment" data-index="${index}">
          <div class="comment-header">
            <div>Варвара Н.</div>
            <div>13.02.22 19:22</div>
          </div>
          <div class="comment-body">
            <div class="comment-text">
              Мне нравится как оформлена эта страница! ❤
            </div>
          </div>
          <div class="comment-footer">
            <div class="likes">
              <span class="likes-counter">75</span>
              <button class="like-button"></button>
            </div>
          </div>
        </li>
      </ul>
      <div class="add-form">
        <input
          type="text"
          class="add-form-name"
          placeholder="Введите ваше имя"
          id="name-input"
        />
        <textarea
          type="textarea"
          class="add-form-text"
          placeholder="Введите ваш коментарий"
          rows="4"
          id="text-input"
          value="text"
        ></textarea>
        <div class="add-form-row">
          <button class="add-form-button" id="add-form-button">Написать</button>
        </div>
      </div>
    </div>
  </body>
  <style>
    .error {
      background-color: red;
    }
  </style>

  <script>
    "use strict";
     
     const name = document.getElementById("name-input");
 const text = document.getElementById("text-input");
    const sanitizeHtml = (value) => {
      return value.replaceAll("<","&lt;").replaceAll(">","&gt;");
    }

    const buttonElement = document.getElementById("add-form-button");
    const listElement = document.getElementById("comments");
    const nameInputElement = document.getElementById("name-input");
    const textInputElement = document.getElementById("text-input");
    
const commentDate = new Date();

function fnDate(commentDate) {
  const day = String(commentDate.getDate()).padStart(2, '0')
  const month = String(commentDate.getMonth() + 1).padStart(2, '0')
  const year = commentDate.getFullYear().toString().slice(-2)
  const hours = commentDate.getHours().toString().padStart(2, '0')
  const minutes = commentDate.getMinutes().toString().padStart(2, '0')

  // return ${day}.${month}.${year} ${hours}:${minutes};
}

    

// buttonElement.addEventListener("click", () => {
//   nameInputElement.classList.remove('error');
//   if (nameInputElement.value === "") {
//     nameInputElement.classList.add('error');
//     return;
//   }

//   textInputElement.classList.remove('error');
//   if (textInputElement.value === "") {
//     textInputElement.classList.add('error');
//     return;
//   }

//   const oldListElement = listElement.innerHTML;
//   listElement.innerHTML =
//     oldListElement +
//     <li class="comment">
//       <div class="comment-header">
//         <div> ${nameInputElement.value} </div>
//         <div> ${fnDate(new Date())} </div>
//       </div>
//       <div class="comment-body">
//         <div class="comment-text">
//           ${textInputElement.value}
//         </div>
//       </div>
//       <div class="comment-footer">
//         <div class="likes">
//           <span class="likes-counter">0</span>
//           <button class="like-button"></button>
//         </div>
//       </div>
//     </li>;
//     initLikeButtons();
//   // Очистка формы
//   nameInputElement.value = "";
//   textInputElement.value = "";
// });


// function initLikeButtons() {
//   const likeButtons = document.querySelectorAll('.like-button');
//   likeButtons.forEach((button) => {
//     button.addEventListener('click', () => {
//       const counter = button.closest('.likes').querySelector('.likes-counter');
//       const count = Number(counter.textContent);
//       if (button.classList.contains('-active-like')) {
//         counter.textContent = count - 1;
//         button.classList.remove('-active-like');
//       } else {
//         counter.textContent = count + 1;
//         button.classList.add('-active-like');
//       }
//     });
//   });
// }
// // Вызов при загрузке страницы (для уже существующих комментариев)
// initLikeButtons();

// listElement.innerHTML = oldListElement + ...;
// initLikeButtons();


    // Код писать здесь
    console.log("It works!");

    const comments = [{
name: "Глеб Фокин",
date: new Date(),
text:"Это будет первый комментарий на этой странице",
likes:"3",
isLiked:false,
    },
    {
name:"Варвара Н.",
date:new Date(),
text:"Мне нравится, как оформлена эта страница",
likes:"75",
isLiked:true,
    },
  ];

  const renderComments = () => {
    const list = document.querySelector(".comments");

    list.innerHTML = comments
    .map((comment, index) => {
     return `
     
     <li class="comment" id="comment" data-index="${index}">
          <div class="comment-header">
            <div>${comment.name}</div>
            <div>${comment.date.toLocaleDateString()}</div>
          </div>
          <div class="comment-body">
            <div class="comment-text">
              ${comment.text}
            </div>
          </div>
          <div class="comment-footer">
            <div class="likes">
              <span class="likes-counter">${comment.likes}</span>
              <button data-index="${index}" class="like-button ${comment.isLiked ? "-active-like" : ""}"></button>
            </div>
          </div>
        </li>`;
        
    })
    .join("");

    const likeButtons = document.querySelectorAll(".like-button")
    for(const likeButton of likeButtons) {
      likeButton.addEventListener("click", (event) => {

        event.stopPropagation();
        
        const index = likeButton.dataset.index;
        const comment = comments[index];

      comment.likes = comment.isLiked ? comment.likes - 1 : comment.likes +1;
        

        comment.isLiked = !comment.isLiked;

        renderComments();
      })
    }
    const commentsElements = document.querySelectorAll(".comment");

    for (const commentElement of commentsElements) {
      commentElement.addEventListener("click", () => {
        
        const currentComment = comments[commentElement.dataset.index];
        text.value = `${currentComment.text}: ${currentComment.name}`;

      })
    }
};

renderComments();

const addButton = document.querySelector(".add-form-button")
addButton.addEventListener("click", () => {
 if (!name.value || !text.value) {
 console.error("заполните поля")
  return
 }

  const newComment = {
  name: sanitizeHtml(name.value),
  date: new Date(),
  text: sanitizeHtml(text.value),
  likes:"0",
  isLiked: false,
};

comments.push(newComment);
renderComments();

name.value ="";
text.value = "";
});


  </script>
</html>

